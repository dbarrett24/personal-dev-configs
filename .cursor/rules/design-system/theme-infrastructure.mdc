---
description: Theme system architecture and CSS variable usage patterns
globs: ["**/theme/**/*.css", "**/*.css", "**/tailwind.config.*"]
---

# Theme System Infrastructure

## Module Organization Philosophy (Updated 2026-02-11)

### Modular Tailwind Plugin Structure

The theme system uses a modular structure mirroring Hammer UI's architecture:

```
theme-system/src/
├── tailwind/                      # Modular Tailwind configuration
│   ├── cssVars.ts                 # TypeScript constants for CSS variable names
│   ├── colors.ts                  # Color config using cssVars + wrapVar
│   ├── boxShadow.ts               # Shadow tokens
│   ├── borderRadius.ts            # Radius tokens
│   ├── fontFamily.ts              # Font family tokens
│   ├── spacing.ts                 # Spacing scale (fixed values)
│   ├── width.ts                   # Layout width tokens
│   ├── text.ts                    # Typography component classes
│   ├── screens.ts                 # Responsive breakpoints
│   └── plugin.ts                  # Main plugin (assembles complete theme)
├── themes/                        # Brand definitions (TypeScript)
│   ├── BasketballTraining.ts      # colorAliases + nonColorVariables
│   ├── ProfessionalBrand.ts
│   ├── Default.ts
│   ├── brands.ts                  # Brand name → CSS class mapping
│   ├── generateCSSVars.ts         # TS → CSS converter
│   └── writeToCSSFile.ts          # File writer utility
├── utils/
│   ├── wrapVar.ts                 # Variable wrapping utilities
│   ├── color.ts                   # tinycolor2 color generation
│   └── cn.ts                      # Class name merge utility
└── index.ts                       # Exports all modules
```

### Benefits of Modular Structure

1. **Single Responsibility**: Each file has one clear purpose
2. **Type Safety**: `cssVars.ts` provides TypeScript constants preventing typos
3. **Tree-Shakable**: Consumers can import only what they need
4. **Testable**: Each module can be tested independently
5. **Maintainable**: Small focused files easier to navigate

### Import Patterns

**For Tailwind plugin** (most common):
```typescript
// Consumer app's tailwind.config.js
const { themePlugin } = require('@dbarrett24/theme-system');

module.exports = {
    plugins: [themePlugin],  // Plugin defines complete theme
};
```

**For individual modules** (advanced usage):
```typescript
import { colors } from '@dbarrett24/theme-system/colors';
import { spacing } from '@dbarrett24/theme-system/spacing';
import { screens } from '@dbarrett24/theme-system/screens';
```

**For utilities**:
```typescript
import { cn } from '@dbarrett24/theme-system';
import { wrapVar, wrapVariableOpacity } from '@dbarrett24/theme-system/wrapVar';
import { generateNormalColorSteps } from '@dbarrett24/theme-system/color';
```

**For brand metadata**:
```typescript
import { brands, brandsToCSS } from '@dbarrett24/theme-system/brands';
```

## Overview

This project uses a comprehensive CSS variable-based theme system with multi-brand support. The theme infrastructure follows industry-standard naming conventions with `--color-*` prefixes for semantic organization.

## CSS Variables

### Color Variables (Semantic Naming)

All color variables use the `--color-*` prefix for better organization:

**Background Colors**:
- `--color-background-primary`: Main background color
- `--color-background-secondary`: Secondary background (cards, panels)
- `--color-background-tertiary`: Tertiary background (hover states)
- `--color-background-inverse`: Inverse background (for dark-on-light)
- `--color-background-overlay`: Semi-transparent overlay

**Text Colors**:
- `--color-text-primary`: Primary text color
- `--color-text-secondary`: Secondary text (less emphasis)
- `--color-text-tertiary`: Tertiary text (least emphasis)
- `--color-text-inverse`: Inverse text color
- `--color-text-disabled`: Disabled text color
- `--color-text-link`: Link text color
- `--color-text-success`: Success message text
- `--color-text-warning`: Warning message text
- `--color-text-critical`: Error message text
- `--color-text-info`: Info message text

**Border Colors**:
- `--color-border-primary`: Default border color
- `--color-border-secondary`: Secondary border (subtle dividers)
- `--color-border-focus`: Focus ring color
- `--color-border-success`: Success state border
- `--color-border-warning`: Warning state border
- `--color-border-critical`: Error state border
- `--color-border-info`: Info state border

**Link Colors** (renamed from "interactive"):
- `--color-link-primary`: Primary link/button color
- `--color-link-hover`: Link hover state
- `--color-link-pressed`: Link active/pressed state
- `--color-link-secondary`: Secondary link color
- `--color-link-disabled`: Disabled link color

### Typography Variables

**Font Families**:
- `--font-family-primary`: Primary brand font (Inter by default)
- `--font-family-secondary`: Secondary brand font (Georgia by default)

**Button Typography**:
- `--font-size-button-100`: Base button font size (14px)
- `--font-size-button-200`: Small button font size (12px)
- `--font-weight-button`: Button font weight (600)
- `--letter-spacing-button`: Button letter spacing (1px)
- `--text-transform-button`: Button text transform (uppercase)

**Typography Font Weights** (11 variables):
- `--font-weight-h1` through `--font-weight-h6`
- `--font-weight-body-primary`
- `--font-weight-body-secondary`
- `--font-weight-caption`
- `--font-weight-label-strong`
- `--font-weight-label-mini`

**Typography Letter Spacing** (14 variables):
- `--letter-spacing-h1`, `--letter-spacing-h1-mobile`
- `--letter-spacing-h2`, `--letter-spacing-h2-mobile`
- `--letter-spacing-h3`, `--letter-spacing-h3-mobile`
- `--letter-spacing-h4` through `--letter-spacing-h6`
- `--letter-spacing-body-primary`, `--letter-spacing-body-secondary`
- `--letter-spacing-caption`
- `--letter-spacing-label-strong`, `--letter-spacing-label-mini`

**Text Transform**:
- `--text-transform-h6`: uppercase
- `--text-transform-label-mini`: uppercase

### Border Radius Tokens

Component-specific border radius variables:

- `--button-border-radius`: 8px (button corners)
- `--input-border-radius`: 6px (input fields)
- `--container-border-radius`: 12px (cards, containers)
- `--checkbox-border-radius`: 4px (checkboxes)
- `--search-input-border-radius`: 24px (search inputs - pill shape)

These can be used in Tailwind via `rounded-button`, `rounded-input`, etc.

## Spacing Scale

The spacing scale uses larger values for improved visual hierarchy:

| Token | Value | Old Value | Notes |
|-------|-------|-----------|-------|
| `3xs` | 2px   | 2px       | Unchanged |
| `2xs` | 4px   | 4px       | Unchanged |
| `xs`  | 8px   | 8px       | Unchanged |
| `sm`  | **16px** | 12px   | ⚠️ **+33%** |
| `md`  | **24px** | 16px   | ⚠️ **+50%** |
| `lg`  | **32px** | 24px   | ⚠️ **+33%** |
| `xl`  | **48px** | 32px   | ⚠️ **+50%** |
| `2xl` | **64px** | 40px   | ⚠️ **+60%** |
| `3xl` | **128px** | 48px  | ⚠️ **+167%** |

**Usage in Tailwind**: `px-sm`, `py-md`, `gap-lg`, `space-x-xl`, etc.

## Custom Tailwind Utilities

All custom utilities use the `.hui-*` prefix for consistency.

### Focus Styles

- `.hui-focus-visible-outline`: Standard focus ring using theme's border-focus color with 4px width
- `.hui-focus-visible-outline-inverse`: Inverse focus ring (white, 4px) for dark backgrounds

**Usage**:
```tsx
<button className="hui-focus-visible-outline">
  Standard Focus
</button>
<button className="hui-focus-visible-outline-inverse bg-gray-900">
  Inverse Focus
</button>
```

### Typography Classes

Responsive typography with brand-aware CSS variables:

- `.hui-text-h1` - Heading 1 (32px → 24px mobile)
- `.hui-text-h2` - Heading 2 (24px → 20px mobile)
- `.hui-text-h3` - Heading 3 (20px → 16px mobile)
- `.hui-text-h4` - Heading 4 (16px)
- `.hui-text-h5` - Heading 5 (16px, semibold)
- `.hui-text-h6` - Heading 6 (14px, uppercase)
- `.hui-text-body-primary` - Body text (16px) - **Used for inputs**
- `.hui-text-body-secondary` - Secondary text (14px)
- `.hui-text-caption` - Caption text (12px)

**Features**:
- Mobile-responsive (h1-h3 adapt at 767px breakpoint)
- Font families use CSS variables (brand customization)
- Font weights use CSS variables (brand customization)
- Letter spacing uses CSS variables (brand customization)

**Usage**:
```tsx
<h1 className="hui-text-h1">Page Title</h1>
<p className="hui-text-body-primary">Standard paragraph text</p>
<input className="hui-text-body-primary" placeholder="Input uses body-primary" />
```

### Form Utilities

- `.hui-autofill-transparent`: Removes yellow autofill background, matches theme's background-primary

**Usage**:
```tsx
<input 
  type="email"
  className="hui-autofill-transparent hui-text-body-primary"
  placeholder="Email address"
/>
```

## Usage Examples

### In Components

```tsx
import { cn } from '@dbarrett24/theme-system';

export const Button = ({ variant }: ButtonProps) => {
  return (
    <button
      className={cn(
        'hui-focus-visible-outline',  // Theme-aware focus ring
        'rounded-button',              // Semantic border radius
        'px-sm py-xs',                 // Updated spacing scale
        'font-primary',                // Brand-aware font family
        variant === 'primary' && 'bg-color-link-primary'
      )}
    >
      Click me
    </button>
  );
};
```

### In Brand Theme CSS

```css
.brand-basketball {
    /* Override typography for brand */
    --font-family-primary: 'Roboto', sans-serif;
    --font-weight-button: 700;  /* Bolder buttons */
    --button-border-radius: 12px;  /* More rounded */
    
    /* Brand colors with semantic naming */
    --color-link-primary: #ff6b35;  /* Basketball orange */
    --color-link-hover: #e55a25;
}
```

### Tailwind Config Usage

```javascript
// Import the plugin
import { themePlugin } from '@dbarrett24/theme-system';

export default {
    plugins: [themePlugin],
    // ...
}
```

## Migration Notes

### Breaking Changes from Original System

1. **Spacing scale increased**:
   - `sm`: 12px → **16px** (+33%)
   - `md`: 16px → **24px** (+50%)
   - `lg`: 24px → **32px** (+33%)
   - `xl`: 32px → **48px** (+50%)
   - `2xl`: 40px → **64px** (+60%)
   - `3xl`: 48px → **128px** (+167%)

2. **Color variable naming updated**:
   - All colors now use `--color-*` prefix (industry standard)
   - Example: `--background-primary` → `--color-background-primary`

3. **Interactive variables renamed to link**:
   - `--interactive-primary` → `--color-link-primary`
   - `--interactive-primary-hover` → `--color-link-hover`
   - `--interactive-primary-active` → `--color-link-pressed`

4. **New semantic tokens added**:
   - Border radius: `rounded-button`, `rounded-input`, `rounded-container`, etc.
   - Font families: `font-primary`, `font-secondary`

5. **Custom utilities available**:
   - Typography: `.hui-text-h1` through `.hui-text-caption`
   - Focus: `.hui-focus-visible-outline`, `.hui-focus-visible-outline-inverse`
   - Forms: `.hui-autofill-transparent`

### Removed Components

As part of establishing clean infrastructure:
- **Input component** (placeholder) - Will be replaced in DS-17
- **LoadingSpinner component** (placeholder) - Will be replaced later

These were test/placeholder components and had no production usage.

## Architecture Decisions

### Why `--color-*` Prefix?

Industry standard naming convention used by modern design systems (Material UI, Chakra UI, Tailwind CSS v4). Provides:
- Better organization in browser DevTools
- Clear semantic meaning
- Easier searching across theme files
- Consistency with future tooling

### Why `.hui-*` Utility Prefix?

Follows Hammer UI component library patterns. Enables:
- Seamless integration with third-party libraries
- No naming conflicts with Tailwind utilities
- Clear distinction between framework and custom utilities
- Consistent component library experience

### Why Larger Spacing Scale?

Modern design systems prioritize readability and breathing room:
- Improves visual hierarchy
- Better mobile touch targets
- Aligns with accessibility guidelines
- Matches contemporary UI trends (2024-2026)

## File Locations (Updated 2026-02-11)

**Theme System Package**:
- Modular config: `shared-configs/theme-system/src/tailwind/*.ts` (10 files)
- Brand definitions: `shared-configs/theme-system/src/themes/*.ts` (TypeScript)
- Utilities: `shared-configs/theme-system/src/utils/*.ts` (wrapVar, color, cn)
- Generated CSS: `shared-configs/theme-system/dist/css/*.css` (build-time)
- Package config: `shared-configs/theme-system/package.json`

**Brand Libraries** (components only):
- Basketball: `brand-libraries/basketball-training-ui/src/components/`
- Professional: `brand-libraries/professional-brand-ui/src/components/`
- ❌ NO `src/theme/` directories (deleted in DS-15b)

**Consumer Apps** (CSS imports):
- Storybook: `apps/docs/.storybook/global.css`
- Next.js: `apps/nextjs-app/app/globals.css`
- React Vite: `apps/react-vite/src/index.css`

**Example consumer CSS**:
```css
/* Import generated CSS from theme-system */
@import '@dbarrett24/theme-system/css/BasketballTraining.css';
@import '@dbarrett24/theme-system/css/ProfessionalBrand.css';

@tailwind base;
@tailwind components;
@tailwind utilities;
```

**Documentation**:
- Architecture overview: `ARCHITECTURE.md`
- This reference: `.cursor/rules/design-system/theme-infrastructure.mdc`

## Related Patterns

- **Component Porting**: `.cursor/rules/workflow/component-porting-guide.mdc`
- **Theming Architecture**: `.cursor/rules/architecture/theming.mdc`
- **Monorepo Builds**: `.cursor/rules/architecture/monorepo-builds.mdc`

---

**Last Updated**: 2026-02-11 (DS-15b modular restructure)
