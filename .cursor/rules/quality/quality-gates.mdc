---
description: Framework for deciding which quality gates apply to different types of changes
globs: ["**/*.ts", "**/*.tsx", "**/*.js", "**/*.jsx", "**/*.css"]
alwaysApply: false
---

# Quality Gate Decision Framework

## Overview

Not all changes require all quality checks. This rule provides a framework for determining which quality gates apply.

## Quality Gates Available

1. **TypeScript Compilation** - Always required for .ts/.tsx files
2. **Prettier** - Always required for formatted code
3. **ESLint** - Required for new/modified code (may skip if pre-existing config issues)
4. **Tests** - Required for new features and bug fixes
5. **Codacy Analysis** - Conditional (see below)

## Codacy Analysis Decision Tree

### ALWAYS Run Codacy:
- ✅ New feature implementation (new components, new utils)
- ✅ Bug fixes in existing logic
- ✅ Security-related changes
- ✅ Complex refactoring (multiple files, logic changes)
- ✅ Adding/changing dependencies (npm install, yarn add, pnpm add)

### CONDITIONAL - May Skip Codacy:
- ⚠️ **Configuration-only changes** (jest.config.js, tsconfig.json)
  - Rationale: Config files are validated by the tools themselves
  - Alternative: Verify the tool runs successfully (e.g., `pnpm test` for Jest config)

- ⚠️ **Simple import removals** (removing unused imports, removing `import React`)
  - Rationale: TypeScript compilation already validates import correctness
  - Alternative: Verify TypeScript compilation passes

- ⚠️ **Documentation updates** (README.md, .mdc files, comments)
  - Rationale: Markdown/docs don't have code smells or security issues
  - Alternative: Manual review for accuracy

- ⚠️ **Dependency removals** (removing packages)
  - Rationale: Removing dependencies reduces attack surface
  - Alternative: Verify tests still pass

### NEVER Skip Codacy:
- ❌ Adding dependencies (potential security vulnerabilities)
- ❌ Logic changes (potential bugs or code smells)
- ❌ New code (establish quality baseline)

## When Codacy CLI Not Installed

If Codacy CLI is not installed:
1. Document the skip with rationale in the plan/verification
2. Rely on alternative quality gates (TypeScript, tests, Prettier)
3. Recommend user install Codacy CLI for future sessions
4. Proceed if other quality gates pass

## Documentation Pattern

When skipping Codacy, document:

```markdown
### Codacy Analysis
- ⚠️ Status: SKIPPED
- Reason: [Configuration-only changes | Simple import removals | Documentation updates]
- Alternative Validation:
  - ✅ TypeScript compilation: PASS
  - ✅ Prettier: PASS
  - ✅ Tests: 50/50 passing
- Impact: Low (no logic changes)
```

## Example: TEST-SWC-001 Session

**Changes Made**:
- Jest config updates (configuration)
- Removed `import React` statements (simple import removal)
- Documentation updates (.mdc files, README.md)
- Dependency changes (removed Babel, added @swc)

**Codacy Decision**: SKIPPED
- Jest config: Validated by running `pnpm test` (50/50 pass)
- Import removals: Validated by TypeScript compilation (no errors)
- Documentation: Manual review for accuracy
- Dependency changes: Only dev dependencies, tests validate functionality

**Alternative Quality Gates**:
- ✅ TypeScript compilation: PASS
- ✅ Tests: 50/50 passing
- ✅ Prettier: PASS
- ✅ No security vulnerabilities introduced (dev deps only)

**Result**: Safe to proceed without Codacy analysis.
