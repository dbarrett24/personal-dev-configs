---
description: Framework for deciding which quality gates apply to different types of changes
globs: ['**/*.ts', '**/*.tsx', '**/*.js', '**/*.jsx', '**/*.css']
alwaysApply: false
---

# Quality Gate Decision Framework

## Overview

Not all changes require all quality checks. This rule provides a framework for determining which quality gates apply.

## Quality Gates Available

1. **TypeScript Compilation** - Always required for .ts/.tsx files
2. **Prettier** - Always required for formatted code
3. **ESLint** - Required for new/modified code (may skip if pre-existing config issues)
4. **Tests** - Required for new features and bug fixes
5. **Manual Code Review** - Required for security-sensitive changes

## Quality Gate Decision Framework

### ALWAYS Required:

- ✅ TypeScript compilation for .ts/.tsx files
- ✅ Prettier formatting for all code
- ✅ ESLint for new/modified code
- ✅ Tests for new features and bug fixes
- ✅ Manual review for security-related changes

### CONDITIONAL - May Skip Some Gates:

- ⚠️ **Configuration-only changes** (jest.config.js, tsconfig.json)
    - Rationale: Config files are validated by the tools themselves
    - Alternative: Verify the tool runs successfully (e.g., `pnpm test` for Jest config)
    - Skip: Manual review (if tool validation passes)

- ⚠️ **Simple import removals** (removing unused imports, removing `import React`)
    - Rationale: TypeScript compilation already validates import correctness
    - Alternative: Verify TypeScript compilation passes
    - Skip: Additional linting (if TypeScript passes)

- ⚠️ **Documentation updates** (README.md, .mdc files, comments)
    - Rationale: Markdown/docs don't have code smells or security issues
    - Alternative: Manual review for accuracy
    - Skip: Code quality tools (not applicable to docs)

- ⚠️ **Dependency removals** (removing packages)
    - Rationale: Removing dependencies reduces attack surface
    - Alternative: Verify tests still pass
    - Skip: Security scanning (removal is inherently safer)

## Link Verification (Documentation Changes)

### When Link Verification is Required:

- ✅ **Files deleted or moved** (documentation or code)
- ✅ **Files renamed** (changes file references)
- ✅ **Large documentation reorganization** (multiple files affected)

### Link Verification Pattern:

**Search for references to changed files**:

```bash
# Find references to deleted/moved files
grep -r "deleted-file.md" --include="*.md" --include="*.mdc"

# Check for broken links in updated files
# Verify all referenced files exist
```

**Document in verification section**:

```markdown
### Link Verification

- ✅ Status: PASS
- Files checked: [list of files]
- Broken links found: [count]
- Broken links fixed: [count]
- Method: [grep search pattern or manual review]
```

### Example: DOCS-001 Session

**Changes Made**: Deleted 17 documentation files  
**Link Verification**: Required

**Process**:

1. Searched for references to deleted files
2. Checked ARCHITECTURE.md for broken links
3. Found 2 outdated references
4. Fixed broken links before completion

**Result**: All internal documentation links valid

---

### NEVER Skip Quality Gates For:

- ❌ Adding dependencies (requires security review and testing)
- ❌ Logic changes (requires tests and manual review)
- ❌ New code (requires all quality gates)

## Documentation Pattern

When documenting quality gates, include:

```markdown
### Quality Gates

- ✅ TypeScript compilation: PASS
- ✅ Prettier: PASS  
- ✅ ESLint: PASS
- ✅ Tests: 50/50 passing
- ✅ Manual review: [Completed | Not required for this change type]
```

## Example: TEST-SWC-001 Session

**Changes Made**:

- Jest config updates (configuration)
- Removed `import React` statements (simple import removal)
- Documentation updates (.mdc files, README.md)
- Dependency changes (removed Babel, added @swc)

**Quality Gates Applied**:

- ✅ TypeScript compilation: PASS
- ✅ Tests: 50/50 passing (validates config changes)
- ✅ Prettier: PASS
- ✅ Manual review: Config changes validated by successful test execution

**Rationale**:

- Jest config: Validated by running `pnpm test` (50/50 pass)
- Import removals: Validated by TypeScript compilation (no errors)
- Documentation: Manual review for accuracy
- Dependency changes: Only dev dependencies, tests validate functionality

**Result**: All quality gates passed.
